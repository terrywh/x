/*! x.js v1.0.0 / (c) TerryWu / MIT */
const _callback_=Symbol("callback"),_depsCalc_=Symbol("depCalc"),_depsDesc_=Symbol("depDesc"),_proxyContainer=new WeakMap;function invokeCallback(t,e,n,i){let a,o=t[_callback_],r=e.split("."),s=[];for(let t of r){if(!o)return;(a=o["*"])&&s.push.apply(s,a[_callback_]),o=o[t]}o&&s.push.apply(s,o[_callback_]);for(let a=s.length-1;a>=0;--a)s[a].call(t,e,n,i)}function watch(t,e,n){let i,a=t[_callback_],o=e.split(".");a||(a=t[_callback_]={[_callback_]:[]});for(let t of o)a=(i=a[t])||(a[t]={[_callback_]:[]});a[_callback_].push(n)}function unwatch(t,e,n){let i,a=t[_callback_],o=e.split(".");for(let t of o){if(!(i=a[t]))return;a=i}-1!=(i=(a=a[_callback_]).indexOf(n))&&a.splice(i,1)}function calcDepends(t,e){let n=t[_depsCalc_]=[];return e.call(t),t[_depsCalc_]=null,n}function observe(t,e,n){if(exists(t))return _proxyContainer.get(t);n[_depsCalc_]||(n[_depsCalc_]=null),n[_depsDesc_]||(n[_depsDesc_]={});let i=new Proxy(t,{get(t,i){let a=t[i];return"symbol"==typeof i?a:!Array.isArray(t)&&a instanceof Function?a.call(n):(Array.isArray(n[_depsCalc_])&&n[_depsCalc_].push(e+i),"object"==typeof a&&null!==a?observe(a,e+i+".",n):a)},set(t,i,a){if("symbol"==typeof i)return t[i]=a,!0;if(Array.isArray(t)&&"length"===i)return!0;let o=t[i];if(a===o)return!0;Array.isArray(a)?_proxyContainer.has(o)?(o.splice.call(o,o.length),o.push.apply(o,a)):_proxyContainer.has(a)||(observe(a,e+i+".",n),t[i]=a):"object"==typeof a&&null!==a?_proxyContainer.has(o)?Object.assign(_proxyContainer.get(o),a):_proxyContainer.has(a)||observe(a,e+i+".",n):t[i]=a,invokeCallback(n,e+i,a,o);let r=n[_depsDesc_][e+i];if(r)for(let t of r)invokeCallback(n,t,n.$data[t],null);return!0},deleteProperty(t,e){return this.set(t,e,void 0),Array.isArray(t)?t.splice(e,1):delete t[e]}});if(_proxyContainer.set(t,i),!n.$data&&(n.$data=i,!Array.isArray(t)))for(let i in t){let a=t[i];if(a instanceof Function)for(let t of calcDepends(n,a)){let a=n[_depsDesc_][e+t];a||(a=n[_depsDesc_][e+t]=[]),a.push(e+i)}}return i}function exists(t){return _proxyContainer.has(t)}function isObserver(t){return!!t.$data&&!!t[_depsDesc_]}const _binding_=Symbol("binding"),pattern_=/(\$\{[^\}]+\})/g;function getData(t,e){if(Number.isInteger(e))return e;if(""===e)return t;let n=e.split("."),i=t;for(let t of n){if(!i)break;i=i[t]}return i}function setData(t,e,n){let i=e.split("."),a=t,o=i.pop();for(let t of i){if(!a)break;a=a[t]}a[o]=n}function unwrapField(t,e){return"$"==t[0]&&(t=t.substring(2,t.length-1)),"this"==t?t=e.substring(0,e.length-1):"this.$place"==t?((t=e.split(".")).pop(),t=(parseInt(t.pop())||0)+1):"this.$index"==t?((t=e.split(".")).pop(),t=parseInt(t.pop())||0):"this."===t.substring(0,5)&&(t=e+t.substring(5)),t}function bindText(t,e,n,i){let a=function(e,n,i){t.textContent=n},o=getData(n.$data,i);a.field=i,a.call(n,i,o,o),Number.isInteger(i)||(watch(n,i,a),e.push(a))}function scanText(t,e,n,i){let a=0,o=t.textContent.split(pattern_).map(t=>{if("$"!==t[0]||"{"!==t[1]||"}"!==t[t.length-1])return t;++a;let o=new Text;return bindText(o,e,n,unwrapField(t,i)),o});a>0&&t.replaceWith.apply(t,o)}function bindAttribute(t,e,n,i,a){let o=function(n,i,a){t.setAttribute(e,i)},r=getData(i.$data,a);o.field=a,o.call(i,a,r,r),Number.isInteger(a)||(watch(i,a,o),n.push(o))}function bindProperty(t,e,n,i,a){let o=function(n,i,a){t[e]=i,"value"===e&&t instanceof HTMLInputElement&&("radio"==t.type||"checkbox"==t.type)&&(t.checked=!!i)},r=getData(i.$data,a);o.field=a,o.call(i,a,r,r),isObserver(t)||t.setAttribute(e,r),Number.isInteger(a)||(watch(i,a,o),n.push(o),"value"===e?t.addEventListener("change",function(e){t instanceof HTMLInputElement&&("radio"==t.type||"checkbox"==t.type)?setData(i.$data,a,t.checked?1:0):setData(i.$data,a,t.value)}):t.addEventListener("change:"+e,function(n){setData(i.$data,a,t[e])}))}function bindArray(t,e,n,i){let a=t.parentNode,o=new Comment("for("+i+") {{{"),r=new Comment("}}} for("+i+")"),s=i.split(".").length+1,c=getData(n.$data,i),l=new Map;t.replaceWith(o,r);let d=function(e){let i=t.cloneNode(!0),o=i[_binding_];o||(o=i[_binding_]=[]),scanNode(i,o,n,e+".",!1),l.has(e)?l.get(e).push(i):l.set(e,[i]),a.insertBefore(i,r)},u=function(t,e,i){t.split(".").length==s&&(void 0===i?d(t):void 0===e&&function(t){l.has(t)&&l.get(t).forEach(t=>{t.remove();for(let e of t[_binding_])unwatch(n,e.field,e)})}(t))};for(let t=0;t<c.length;++t)d(i+"."+t.toString());watch(n,u.field=i+".*",u),e.push(u)}function bindCondition(t,e,n,i){let a,o=t.parentNode,r=new Comment("if("+i+") {{{"),s=new Comment("}}} if("+i+")");t.replaceWith(r,s);let c=function(e){let i=(a=t.cloneNode(!0))[_binding_];i||(i=a[_binding_]=[]),scanNode(a,i,n,e+".",!1),o.insertBefore(a,s)},l=function(t,e,i){!!e!=!!i&&(e?c(t):function(t){a.remove();for(let t of a[_binding_])unwatch(n,t.field,t)}())};getData(n.$data,i)&&c(i),watch(n,l.field=i,l),e.push(l)}function bindEvent(t,e,n,i,a){t.addEventListener(e,i[a].bind(i))}function scanProp(t,e,n,i){if(t.hasAttribute("x-for")){let a=unwrapField(t.getAttribute("x-for"),i);return t.removeAttribute("x-for"),bindArray(t,e,n,a),!1}if(t.hasAttribute("x-if")){let a=unwrapField(t.getAttribute("x-if"),i);return t.removeAttribute("x-if"),bindCondition(t,e,n,a),!1}for(let a of t.getAttributeNames()){if("x"!=a[0]||"-"!=a[1])continue;let o=a.split(":",2);"x-ref"==o[0]?n.$xref&&(n.$xref[t.getAttribute(a)]=t):"x-on"==o[0]?bindEvent(t,o[1],e,n,t.getAttribute(a)):"x-bbind"==o[0]?bindProperty(t,o[1],e,n,unwrapField(t.getAttribute(a),i)):"x-ubind"==o[0]?bindAttribute(t,o[1],e,n,unwrapField(t.getAttribute(a),i)):"x-value"==o[0]?bindProperty(t,"value",e,n,unwrapField(t.getAttribute(a),i)):bindAttribute(t,a.substring(2,a.length-1),e,n,unwrapField(t.getAttribute(a),i)),t.removeAttribute(a)}return!0}function scanNode(t,e,n,i,a){t&&(!1!==a&&(a=t.nextSibling),t instanceof Text?scanText(t,e,n,i):t instanceof HTMLElement&&scanProp(t,e,n,i)&&scanNode(t.childNodes[0],e,n,i),scanNode(a,e,n,i))}function scan(t,e,n,i){e||(e=t[_binding_]),e||(e=t[_binding_]=[]),scanNode(t.childNodes[0],e,n,i)}function getContainer(t,e){for(;(t=t.parentNode)&&!(t instanceof e););return t}function nameFromProto(t){let e=[],n=0,i=-1,a="";for(n=0;n<t.name.length;++n)t.name[n]>="A"&&t.name[n]<="Z"&&((a=t.name.substring(i,n).toLowerCase()).length>0&&e.push(a),i=n);return(a=t.name.substring(i,n).toLowerCase()).length>0&&"component"!=a&&"controller"!=a&&"container"!=a&&e.push(a),e.join("-")}const _binding_$1=Symbol.binding,_attrDesc_=Symbol.attrDesc;function extend(t,e,n){for(let e in t)Object.defineProperty(n,e,{get:()=>n.$data[e],set(t){n.constructor[_attrDesc_]&&n.constructor[_attrDesc_][e]&&n.setAttribute(e,t),n.$data[e]=t}});if(n instanceof Component)for(let i in t){let t="value"===i?function(){n.dispatchEvent(new Event("change"))}:function(t,e,a){n.dispatchEvent(new Event("change:"+i))};t.field=i,watch(n,i,t),e.push(t)}}function clearBinding(t,e){if(t)for(let n of t)unwatch(e,n.field,n)}class Component extends HTMLElement{constructor(){super();let t=Object.assign("function"==typeof this.constructor.data?this.constructor.data(this):{},Object.fromEntries(Object.getOwnPropertyNames(this).map(t=>[t,this[t]])));if(observe(t,"",this),this[_binding_$1]=[],extend(t,this[_binding_$1],this),"function"==typeof this.constructor.shadow){let t=this.constructor.shadow(),e=this.attachShadow({mode:"open"});t instanceof HTMLTemplateElement?e.appendChild(document.importNode(t.content,!0)):t instanceof Node?e.appendChild(t):"string"==typeof t?e.innerHTML=t:e.innerText="<Unsupported Shadow Content>"}this.$xref={},this.$xapp=null,this.$xctr=null,this.onCreated&&setTimeout(this.onCreated.call(this),0)}connectedCallback(){this.$xapp=getContainer(this,Application),this.$xctr=getContainer(this,Component),null===this.$xctr&&(this.$xctr=this.$xapp),this.shadowRoot?scan(this.shadowRoot,this[_binding_$1],this,""):scan(this,this[_binding_$1],this,""),this.onAttached&&setTimeout(this.onAttached.call(this),0)}disconnectedCallback(){clearBinding(this[_binding_$1],this),this.onDetached&&setTimeout(this.onDetached.call(this),0)}static get observedAttributes(){if(this[_attrDesc_]={},"function"==typeof this.data){let t=[],e=Object.getOwnPropertyDescriptors(this.data());for(let n in e){let i=typeof e[n].value;"string"!==i&&"number"!=i||(this[_attrDesc_][n]=i,t.push(n))}return t}return[]}attributeChangedCallback(t,e,n){let i=this.constructor[_attrDesc_][t];i&&("number"===i&&(n=parseFloat(n)),setData(this.$data,t,n))}}class Application extends HTMLElement{constructor(){super();let t="function"==typeof this.constructor.data?this.constructor.data(this):{};observe(t,"",this),this[_binding_$1]=[],extend(t,this[_binding_$1],this),this.$xref={},this.onCreated&&setTimeout(this.onCreated.call(this),0)}connectedCallback(){scan(this,this[_binding_$1],this,""),this.onAttached&&setTimeout(this.onAttached.call(this),0)}disconnectedCallback(){this.onDetached&&setTimeout(this.onDetached.call(this),0)}}function register(){let t=Array.from(arguments);for(;t.length;){let e,n=t.shift();"function"==typeof n?n=nameFromProto(e=n):e=t.shift(),"object"==typeof e?n instanceof HTMLElement?registerApplication(n,e):registerComponent(n,e):window.customElements.define(n,e)}}function registerApplication(t,e){window.customElements.define(t.tagName.toLowerCase(),class extends Application{constructor(){super();for(let t in e){let n=e[t];"function"==typeof n&&(this[t]=n)}this.onCreated&&setTimeout(this.onCreated.call(this),0)}static data(){return"function"==typeof e.data?e.data():Object.assign({},e.data)}})}function registerComponent(t,e){window.customElements.define(t,class extends Component{constructor(){super();for(let t in e){let n=e[t];"function"==typeof n&&(this[t]=n)}this.onCreated&&setTimeout(this.onCreated.call(this),0)}static data(){return"function"==typeof e.data?e.data():Object.assign({},e.data)}static shadow(){return"function"==typeof e.shadow?e.shadow():e.shadow||document.createElement("div")}})}function X(t){isObserver(t)?watch.apply(this,Array.from(arguments)):register.apply(this,Array.from(arguments))}X.Component=Component,X.Application=Application;export default X;